# ID Convention in ClimaEdu

## Prefixed IDs

In this project, we've adopted the use of **Prefixed IDs** (or Typed IDs) for all entities. This architectural decision offers several significant advantages:

- 🔍 **Improves readability and debugging**: Immediate visual identification of entity types
- 🧠 **Enhances cognition**: Instant recognition of entity types during development
- 🔐 **Prevents confusion between entities**: Avoids errors when handling IDs of different entities with the same format
- 📚 **Simplifies Firestore visualization**: Especially useful when working with subcollections

## Adopted Pattern

The standard format for all IDs in the system is:

```plaintext
<prefix>_<uniqueId>
```

Where:
- `prefix`: 3 to 5 letters that clearly identify the entity
- `uniqueId`: generated by UUID or custom mechanism (Ex: nanoid, cuid, or Firebase auto-ID)

## List of Prefixes and Collections

The table below defines the prefixes for all system entities, organized by Bounded Context:

| Entity                  | Prefix        | Collection / Subcollection |
|-------------------------|------------------|-----------------------------|
| **User**                | `usr_`           | `users`                    |
| **Profile**             | (inline)         | embedded in `users`        |
| **Institution**         | `ins_`           | `institutions`             |
| **Course**              | `crs_`           | `courses`                  |
| **Module**              | `mod_`           | `modules` (subcol. of course) |
| **Lesson**              | `les_`           | `lessons` (subcol. of module) |
| **Content**             | `cnt_`           | `contents` (subcol. of lesson) |
| **Activity**            | `act_`           | `activities` (subcol. of lesson) |
| **Questionnaire**       | `qstnr_`         | `questionnaires` (subcol. of lesson) |
| **Question**            | `qst_`           | `questions` (subcol. of questionnaire) |
| **QuestionnaireSubmission** | `subq_`     | `questionnaire_submissions` |
| **QuestionSubmission**  | `subqs_`         | `question_submissions` (subcol. of submission) |
| **Enrollment**          | `enr_`           | `enrollments`              |
| **Certificate**         | `cert_`          | `certificates`             |
| **Badge**               | `bdg_`           | `badges`                   |
| **StudentBadge**        | `sb_`            | `student_badges` (subcol. of user) |
| **Report (all types)**  | `rpt_`           | `reports` or generated on-demand |
| **Podcast**             | `pod_`           | `podcasts` (subcol. of institution) |
| **PodcastView**         | `podv_`          | `podcast_views` (subcol. of institution) |
| **PodcastLike**         | `podl_`          | `podcast_likes` (subcol. of institution) |
| **Post**                | `pst_`           | `posts`                    |
| **Comment**             | `cmt_`           | `comments`                 |
| **PostLike**            | `plike_`         | `post_likes`               |
| **CommentLike**         | `clike_`         | `comment_likes`            |
| **Email (Value Object)**| (inline)         | embedded in `users`        |

## Implementation Guidelines

### Relationships

For fields that represent relationships between entities (e.g., `userId`, `courseId`), always use the prefixed ID of the related entity:

```typescript
// Example
const enrollment = {
  id: 'enr_abc123',
  userId: 'usr_xyz987',
  courseId: 'crs_def456',
  // ...
};
```

### Firestore Structure

The data structure in Firestore follows these conventions:

- **Main Collections**: Used for root entities (`courses`, `institutions`, etc.)
- **Subcollections**: Used for dependent entities (`modules` within `courses`, etc.)

## Complete Example (Firestore Structure)

```plaintext
institutions (ins_)
  └── ins_abc123
        ├── users (usr_)
        │     └── usr_xyz987
        │           └── student_badges (sb_)
        ├── courses (crs_)
              └── crs_001
                    ├── modules (mod_)
                    │     └── mod_01
                    │           └── lessons (les_)
                    │                 └── les_a1
                    │                       ├── contents (cnt_)
                    │                       ├── activities (act_)
                    │                       └── questionnaires (qstnr_)
                    │                             └── qstnr_xx
                    │                                   └── questions (qst_)
        ├── enrollments (enr_)
        ├── certificates (cert_)
        ├── reports (rpt_)
        ├── posts (pst_)
        ├── comments (cmt_)
        ├── post_likes (plike_)
        └── comment_likes (clike_)
```

## Benefits

Adopting this convention brings the following direct benefits:

- 🔍 **Clean and unambiguous visualization**: Makes code reading and debugging easier
- ⚠️ **Prevents ID collisions**: Eliminates the risk of confusing IDs from different entities
- 📁 **Clarity in data structure**: Makes the database structure more intuitive
- 🔐 **Traceability between documents**: Facilitates tracking relationships between entities

## Technical Implementation

When implementing this convention in code, it is recommended to:

1. Create ID generation functions for each entity type
2. Use TypeScript types to ensure the correct IDs are used in the right places
3. Implement validation to ensure IDs follow the correct format

Implementation example:

```typescript
// Example function to generate prefixed IDs
function generateId(prefix: string): string {
  const uniqueId = crypto.randomUUID().replace(/-/g, '').substring(0, 10);
  return `${prefix}_${uniqueId}`;
}

// Entity-specific functions
export const generateUserId = () => generateId('usr');
export const generateCourseId = () => generateId('crs');
// ...
```

## Conclusion

The adoption of prefixed IDs is an architectural decision that brings significant benefits for code maintenance, readability, and robustness. This convention should be followed consistently throughout the project to ensure its benefits.
