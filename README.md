# ClimaEdu - Learning Content Management Portal

A complete digital education platform that allows management of users, content, enrollments, assessments, forums, and certificates.

## Project Structure

The project follows Clean Architecture principles with a modular structure:

```
src/
  modules/
    user/
      core/
        entities/
        use-cases/
      infrastructure/
        repositories/
        implementations/
      index.ts
    content/
      (similar structure)
    auth/
      (similar structure)
  shared/
    firebase/
    container/
  components/
  app/
```

## Technologies

- **Frontend**: Next.js 15, React 19, TailwindCSS, shadcn/ui
- **Backend**: Firebase (Authentication, Firestore, Storage)
- **Architecture**: Clean Architecture, SOLID, Object Calisthenics
- **Dependency Injection**: InversifyJS

## Development Setup

### Prerequisites

- Node.js 18+ and npm
- Firebase CLI (`npm install -g firebase-tools`)

### Installation

1. Clone the repository
2. Install dependencies:
   ```bash
   npm install
   ```
3. Create a `.env.local` file with your Firebase configuration:
   ```
   NEXT_PUBLIC_FIREBASE_API_KEY=your-api-key
   NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=your-auth-domain
   NEXT_PUBLIC_FIREBASE_PROJECT_ID=your-project-id
   NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=your-storage-bucket
   NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=your-messaging-sender-id
   NEXT_PUBLIC_FIREBASE_APP_ID=your-app-id
   ```

### Firebase Emulators

This project uses Firebase emulators for local development. The emulators allow you to develop and test your application without connecting to the production Firebase services.

#### Starting the Emulators

To start the Firebase emulators:

```bash
npm run emulators
```

This will start the following emulators:
- Authentication: http://localhost:9099
- Firestore: http://localhost:8080
- Storage: http://localhost:9199
- Emulator UI: http://localhost:4000

#### Development with Emulators

To run the Next.js development server with the Firebase emulators:

```bash
npm run dev:emulators
```

This will start both the Firebase emulators and the Next.js development server concurrently.

#### Using Email Link Authentication with Emulators

When using the Firebase Authentication emulator, emails are not actually sent. Instead, the application provides a special UI component on the login page that displays the authentication links generated by the emulator.

To authenticate with the emulator:

1. Go to the login page at http://localhost:3000/login
2. Enter your email address and click "Send Sign-In Link"
3. The emulator will generate a sign-in link, which will be displayed in the "Firebase Emulator Authentication Links" section below the login form
4. Click the "Use Link" button to authenticate
5. You will be redirected to the authentication confirmation page at /auth/confirm
6. The authentication process will complete, and you will be redirected to the home page

**Important Notes for Email Link Authentication:**
- The application automatically stores the email in localStorage when you click "Use Link"
- The authentication link contains parameters that Firebase uses to verify the authentication request
- The authentication process happens on a dedicated page (/auth/confirm) to ensure it completes properly
- You can also view all authentication operations in the Firebase Emulator UI at http://localhost:4000
- If you encounter any issues, check the browser console and the debug information on the confirmation page

**Emulator Limitations and Workarounds:**
- The Firebase emulator has limitations with email link authentication
- You may see a console error: `FirebaseError: Firebase: Error (auth/invalid-action-code)`
- This is expected and handled by the application
- In development mode with the emulator, the application creates a fake user ID to simulate successful authentication
- This allows you to test the authentication flow without needing to connect to the real Firebase services

**Troubleshooting:**
- If authentication fails, try clearing your browser's localStorage and cookies
- Make sure both the Next.js server and Firebase emulators are running (check the EmulatorStatus component)
- Check the browser console for any error messages
- Verify that the email in localStorage matches the email used to generate the link
- If you're redirected to the login page too quickly, try using the "Use Link" button again

### Development without Emulators

If you want to develop using the production Firebase services instead of the emulators:

```bash
npm run dev
```

## Project Structure

The project follows a modular architecture based on Clean Architecture principles:

- **Entities**: Core business objects
- **Use Cases**: Application-specific business rules
- **Repositories/Services**: Interfaces for data access and external services
- **Implementations**: Concrete implementations of repositories and services

## Authentication Flow

The application uses Firebase Authentication with email link (passwordless) authentication:

1. User enters their email address
2. A magic link is sent to the user's email
3. User clicks the link to authenticate
4. The application verifies the link and authenticates the user

### Email Link Authentication Process

1. **Request Phase**:
   - User enters email on the login page
   - Application calls `sendSignInLinkToEmail` Firebase method
   - Email is stored in localStorage for later verification
   - In production, Firebase sends an email with the authentication link
   - In development with emulators, the link is displayed on the login page

2. **Authentication Phase**:
   - User clicks the authentication link
   - User is redirected to the authentication confirmation page (/auth/confirm)
   - Application verifies the link using `isSignInWithEmailLink` Firebase method
   - Application retrieves the email from localStorage
   - Application calls `signInWithEmailLink` Firebase method with the email and link
   - Firebase authenticates the user and returns a user object
   - Application updates the authentication state and redirects to the home page

3. **Emulator-Specific Handling**:
   - When using the emulator, the application detects the fake API key
   - Instead of using the standard Firebase authentication, it creates a fake user ID
   - This allows the authentication flow to work even with the emulator's limitations
   - The fake user ID is used just like a real user ID for the rest of the application

## Contributing

1. Follow the established architecture and patterns
2. Maintain strict TypeScript typing
3. Follow Object Calisthenics principles
4. Write tests for new features

## License

This project is licensed under the MIT License.
